import cv2
import pytesseract
import tkinter as tk
from tkinter import filedialog

# Set the path to the Tesseract executable (replace this with your actual path)
pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'

def open_image():
    file_path = filedialog.askopenfilename(title="Select an Image", filetypes=[("Image files", "*.png;*.jpg;*.jpeg;*.gif")])
    
    if file_path:
        # Read the selected image
        image = cv2.imread(file_path)

        # Use Tesseract to extract text
        text = pytesseract.image_to_string(image)

        # Replace "Ye" with "1/2" in the extracted text
        text = text.replace("Ye", "1/2")

        # Save the extracted text to a .txt file
        output_file_path = 'Recipe.txt'
        with open(output_file_path, 'w') as file:
            file.write(text)

        # Display the original image and extracted text in a simple GUI
        display_result(image, text, output_file_path)

def display_result(image, text, output_file_path):
    # Create a new window
    result_window = tk.Toplevel()
    result_window.title("Image Text Extractor Result")

    # Display the original image
    photo = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
    photo = Image.fromarray(photo)
    photo = ImageTk.PhotoImage(photo)
    image_label = tk.Label(result_window, image=photo)
    image_label.image = photo
    image_label.pack()

    # Display the extracted text
    text_label = tk.Label(result_window, text="Extracted Text:")
    text_label.pack()

    result_text = tk.Text(result_window, height=5, width=50)
    result_text.insert(tk.END, text)
    result_text.pack()

    # Save the extracted text to a .txt file
    save_button = tk.Button(result_window, text="Save to File", command=lambda: save_to_file(output_file_path, text))
    save_button.pack()

def save_to_file(output_file_path, text):
    with open(output_file_path, 'w') as file:
        file.write(text)
    print(f"Extracted text saved to {output_file_path}")

# Create the main window
root = tk.Tk()
root.title("Image Text Extractor")

# Create a button to open the file browser
button = tk.Button(root, text="Open Image", command=open_image)
button.pack()

# Run the Tkinter event loop
root.mainloop()
